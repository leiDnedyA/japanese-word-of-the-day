<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Japanese Word of the Day | Learn a new Japanese Word Daily</title>
  <link rel="icon" href="favicon.png" type="image/png">
  <meta name="description" content="Japanese word of the day | Build the habit of learning one Japanese word per day!">
  <link rel="canonical" href="https://dailykanji.xyz/">
  <meta property="og:title" content="Japanese Word of the Day | dailykanji.xyz">
  <meta property="og:description" content="Build the small habit of learning one Japanese word per day!">
  <meta property="og:image" content="https://dailykanji.xyz/demo.png">
  <meta property="og:url" content="https://dailykanji.xyz/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Japanese Word of the Day | dailykanji.xyz">
  <meta name="twitter:description"
    content="Build the habit of learning one new Japanese word each day, including furigana and meanings.">
  <meta name="twitter:image" content="https://dailykanji.xyz/demo.png">
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-V74YTKD4CF"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() {dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-V74YTKD4CF');
  </script>
  <script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "EducationalOccupationalProgram",
  "name": "Japanese Word of the Day",
  "description": "Japanese word of the day | Build the habit of learning one Japanese word per day!",
  "educationalLevel": "Beginner",
  "provider": {
    "@type": "Organization",
    "name": "Ayden Diel",
    "url": "https://aydendiel.dev"
  }
}
</script>
  <style>
    html,
    body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100vw;
    }

    a {
      color: inherit;
    }

    .wrapper {
      height: 100%;
      width: 100vw;
      font-family: 'Arial', sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      background: linear-gradient(135deg, #ff9a9e 0%, #fad0c4 100%);
      color: #333;
      overflow: hidden;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      background: #ffffffcc;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      position: relative;
      top: 27vh;
      max-width: 500px;
      width: 80%;
    }
    
    @media (max-height: 800px) {
      .container {
        top: 20vh;
      }
    }

    .container.loading>p,
    .container.loading>h2 {
      opacity: .5;
      cursor: default;
    }

    .title {
      font-size: 2rem;
      font-weight: normal;
      margin-top: 0;
      margin-bottom: 8px;
      color: #ff6f61;
    }

    .word {
      font-size: 3rem;
      font-weight: bold;
      color: #333;
      margin-bottom: 10px;
      margin-top: 0;
    }

    .furigana {
      height: 1.2rem;
      font-size: 1rem;
      color: #333;
      margin-top: 15px;
      margin-bottom: 0;
    }

    .furigana.empty {
      display: none;
    }

    .meaning {
      width: 80%;
      text-align: center;
      font-size: 1.2rem;
      color: #666;
      margin-bottom: 10px;
      margin-top: 0;
    }

    .cardFooter {
      line-height: 1.3em;
      font-size: 0.9rem;
      color: #777;
      position: relative;
      bottom: 0;
    }

    .footer {
      font-size: 0.9rem;
      color: #777;
      position: fixed;
      bottom: 0;
      width: 100%;
      text-align: center;
      padding: 10px 0;
    }

    .input {
      background: #ff9196;
      color: white;
      border: none;
      border-radius: 3px;
      padding-top: 3px;
      padding-bottom: 3px;
      padding-left: 5px;
      padding-right: 5px;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      transition: background 200ms;
    }

    .input:hover {
      background: #ff6f61;
    }

    .input:active {
      background: #ff9a9e;
    }

    .button-container {
      margin-bottom: 18px;
    }

    @media (max-width: 768px) {
      .title {
        font-size: 1.5rem;
      }

      .word {
        font-size: 2.5rem;
      }
    }
  </style>
</head>

<body>
  <div class="wrapper">
    <div id="container" class="container loading" role="main">
      <h1 class="title">üáØüáµ Japanese Word of the Day</h1>
      <p class="furigana empty" id="furigana">-</p>
      <h2 class="word" id="word">„É≠„Éº„Éá„Ç£„É≥„Ç∞</h2>
      <p class="meaning" id="meaning">loading...</p>
      <div class="button-container">
        <button class="input" onclick="showRandomWord()" id="random-word-button">Random Word</button>
        <button class="input" onclick="toggleRomaji()" id="show-romaji-button">Show Romaji</button>
        <select onchange="handleJlptLevelChange(this)" id="jlpt-level-dropdown" class="input"
          class="jlpt-level-dropdown">
          <option value="5">JLPT N5</option>
          <option value="4">JLPT N4</option>
          <option value="3">JLPT N3</option>
          <option value="2">JLPT N2</option>
          <option value="1">JLPT N1</option>
        </select>
      </div>
      <footer class="cardFooter">Tip: Add this page to your <strong>bookmarks bar</strong> and come back daily to build
        the habit of learning Japanese!</footer>
    </div>

    <footer class="footer">Made with ‚ù§Ô∏è in üá∫üá∏ by Ayden Diel |
      <a href="https://docs.google.com/forms/d/e/1FAIpQLSf9FCH_Vw5CVCVyaPDpGKYQl5k4fWHivx7UR4mHtJDT-aSqVA/viewform?usp=header"
        target="_blank">Request a Feature</a> |
      <a href="https://aydendiel.dev" target="_blank">aydendiel.dev</a> |
      <a href="https://x.com/aydendiel" target="_blank">X (twitter)</a>
    </footer>
  </div>

  <script>

    console.log("Welcome! „Çà„ÅÜ„Åì„ÅùÔºÅ (‚óè'‚ó°'‚óè)")

    const START_DATE_STRING = "2024-01-06";
    const START_INDEX = 3;

    // Show this word while loading
    let word = {
      "word": "„Çà„ÅÜ„Åì„Åù",
      "furigana": "„Çà„ÅÜ„Åì„Åù",
      "romaji": "yokosou",
      "meaning": "Welcome",
    };

    let jlptLevel = 5;
    let levelWordCount = 0;
    let wordIndex = 0;
    let romajiVisible = false;

    const furiganaText = document.getElementById("furigana");
    const wordText = document.getElementById("word");
    const meaningText = document.getElementById("meaning");
    const showRomajiButton = document.getElementById("show-romaji-button");
    const randomWordButton = document.getElementById("random-word-button");
    const jlptLevelDropdown = document.getElementById("jlpt-level-dropdown");

    /**
     * Checks if a Japanese word contains kanji characters.
     * 
     * @param {string} word - The Japanese word to evaluate.
     * @returns {boolean} - Returns true if the word contains kanji, otherwise false.
     */
    function containsKanji(word) {
      // Unicode range for kanji: U+4E00 to U+9FAF
      const kanjiRegex = /[\u4E00-\u9FAF]/;
      return kanjiRegex.test(word);
    }

    async function getJlptLevelWordCount(level = 1) {
      if (level < 1 || level > 5) {
        throw new Error(`Error, invalid JLPT level ${level}.`)
      }
      // get the total count
      const response = await fetch(`https://jlpt-vocab-api.vercel.app/api/words?level=${level}&limit=1`)
      const data = await response.json();
      return data.total;
    }

    async function getJlptWord(index, level = 1) {
      const response = await fetch(`https://jlpt-vocab-api.vercel.app/api/words?level=${level}&offset=${index}&limit=1`)
      const data = await response.json();
      return data.words[0];
    }

    function toggleRomaji() {
      romajiVisible = !romajiVisible;
      renderCurrentWord();
      localStorage.setItem("romajiVisible", `${romajiVisible}`);
    }

    function getRandomInt(min, max) {
      min = Math.ceil(min);
      max = Math.floor(max);
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    async function showRandomWord() {
      setLoading(true);
      wordIndex = getRandomInt(0, levelWordCount - 1);
      word = await getJlptWord(wordIndex, jlptLevel);
      renderCurrentWord();
      setLoading(false);
    }

    function renderCurrentWord() {
      wordText.textContent = word.word;
      meaningText.textContent = word.meaning;

      const hasKanji = word.furigana !== "";

      if (!hasKanji && !romajiVisible) {
        furiganaText.classList.add("empty");
      } else {
        furiganaText.classList.remove("empty");
      }

      if (romajiVisible) {
        if (!hasKanji) {
          // Only display the romaji
          furiganaText.textContent = `${word.romaji}`;
        } else {
          furiganaText.textContent = `${word.furigana} (${word.romaji})`;
        }
      } else {
        if (hasKanji) {
          furiganaText.textContent = word.furigana;
        }
      }

      if (romajiVisible) {
        showRomajiButton.innerText = "Hide Romaji";
      } else {
        showRomajiButton.innerText = "Show Romaji";
      }
    }

    function setLoading(loading = true) {
      const container = document.getElementById("container");
      if (loading) {
        container.classList.add("loading");
        word = {
          "word": "„É≠„Éº„Éá„Ç£„É≥„Ç∞",
          "furigana": "",
          "romaji": "r≈çdingu",
          "meaning": "loading...",
        };
        renderCurrentWord();
      } else {
        container.classList.remove("loading");
      }
    }

    function getTodaysHash() {
      // Normalize time so word changes at 12AM local time for user
      const startDate = new Date(START_DATE_STRING);
      startDate.setHours(0, 0, 0, 0);
      const now = new Date();
      now.setHours(0, 0, 0, 0);
      const diffInMilliseconds = now - startDate;
      const diffInDays = Math.floor(diffInMilliseconds / (1000 * 60 * 60 * 24));
      return diffInDays + START_INDEX;
    }

    async function handleJlptLevelChange(target) {
      setLoading(true);

      jlptLevel = parseInt(target.value);

      // store value in localstorage
      localStorage.setItem("jlptLevel", `${jlptLevel}`);

      // update view
      const todaysHash = getTodaysHash();
      levelWordCount = await getJlptLevelWordCount(jlptLevel);
      wordIndex = todaysHash % levelWordCount;
      word = await getJlptWord(wordIndex, jlptLevel);

      setLoading(false);
      renderCurrentWord();
    }

    async function initialize() {
      setLoading(true);

      // fetch values from localstorage
      const storedJlptLevel = localStorage.getItem("jlptLevel");
      const storedRomajiVisible = localStorage.getItem("romajiVisible");

      if (storedJlptLevel) {
        if (!isNaN(parseInt(storedJlptLevel))) {
          jlptLevel = parseInt(storedJlptLevel)
          jlptLevelDropdown.value = jlptLevel;
        } else {
          localStorage.removeItem("jlptLevel");
        }
      }

      if (storedRomajiVisible === "true") {
        romajiVisible = true;
      }

      // set current word
      const todaysHash = getTodaysHash();
      levelWordCount = await getJlptLevelWordCount(jlptLevel);
      wordIndex = todaysHash % levelWordCount;
      word = await getJlptWord(wordIndex, jlptLevel);

      setLoading(false);
      renderCurrentWord();
    }

    window.onload = initialize;

  </script>
</body>

</html>
